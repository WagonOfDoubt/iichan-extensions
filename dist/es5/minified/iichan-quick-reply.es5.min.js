!function(){"use strict";var e="iichan-quick-reply-btn",t="Быстрый ответ",n="iichan-quick-reply-container",r="iichan-postform-container",a="iichan-quick-reply-show-form-btn",o="/cgi-bin/captcha1.pl",i=window.location.href.match(/(?:\w+\.\w+\/)([^\/]*)(?=\/)/)[1],d={key:"mainpage",dummy:"",board:i},c=function(){var e=document.createElement("table");e.insertAdjacentHTML("beforeend",'\n          <tr>\n          \t<td class="doubledash">&gt;&gt;</td>\n          \t<td class="'+r+' reply"></td>\n          </tr>\n          \n        '),e.id=n;var t=e.querySelector("."+r);return{quickReplyContainer:e,postformContainer:t}}(),l=c.quickReplyContainer,u=c.postformContainer,s=function(){var e=document.createElement("a");return e.classList.add(a),e}(),y=function(){var e=document.createElement("input");return e.setAttribute("type","hidden"),e.setAttribute("name","parent"),e}(),p=function(){var e=document.querySelector("#captcha");if(e){var t=d.key,n=d.dummy,r=d.board;e.src=o+"/"+r+"/?key="+t+"&dummy="+n+"&"+Math.random()}},f=function(e){if(e){var t=e.id.substr("thread-".length),n=e.querySelector("table:last-child .reply"),r=n?n.id.substr("reply".length):t;d.key="res"+t,d.dummy=r}else d.key="mainpage",d.dummy="";p()},m=function(e,t){var n=e.querySelector("[name=parent]");return t?(n||(n=y,e.appendChild(n)),void n.setAttribute("value",t)):void(n&&e.removeChild(n))},v=function(e,t){for(var n=e;n&&n!==document&&!n.matches(t);)n=n.parentNode;return n===document?null:n},h=function(e){var t=document.querySelector("[name=nya4]");t&&(t.focus(!1),e&&(e=">>"+e+"\n",t.value.endsWith(e)||(t.value.length&&!t.value.endsWith("\n")&&(e="\n"+e),t.setRangeText(e,t.textLength,t.textLength,"end"))))},b=function(){var e=document.querySelector(".postarea");e&&e.appendChild(s)},q=function(e,t){var n=v(t,"table"),r=v(t,"[id^=thread]");if(n&&r){var a=r.id.substr("thread-".length),o=t.id.substr("reply".length);u.appendChild(e),n.parentNode.insertBefore(l,n.nextSibling),b(),m(e,a),f(r),h(o)}},g=function(e,t){var n=t.querySelector("table"),r=t.id.substr("thread-".length);u.appendChild(e),t.insertBefore(l,n),b(),m(e,r),f(t),h(r)},S=function(e,t){var n=document.querySelector(".postarea");if(n&&(n.appendChild(e),t&&h()),l.parentNode&&l.parentNode.removeChild(l),s.parentNode&&s.parentNode.removeChild(s),document.body.classList.contains("replypage")){var r=document.querySelector("[id^=thread]"),a=r.id.substr("thread-".length);m(e,a),f(r)}else m(e,null),f()},k=function(e){var t=document.querySelector("#postform");t&&(e?t.dataset.replyTo===e.id?(t.dataset.replyTo="",S(t,!1)):e.classList.contains("reply")?(t.dataset.replyTo=e.id,q(t,e)):(t.dataset.replyTo=e.id,g(t,e)):(t.dataset.replyTo="",S(t,!0)))},L=function(e){var t=e.target,n=document.querySelector(t.dataset.postId);k(n)},C=function(n){if(n){var r=n.querySelector(":scope > .reflink");if(r){var a=document.createElement("span");a.title=t,a.classList.add(e),a.dataset.postId="#"+n.id,a.addEventListener("click",L),n.insertBefore(a,r.nextSibling)}}},w=function(e){var t=(e||document).querySelectorAll(".reply, [id^=thread]"),n=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var d=o.value;C(d)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}},E=function(){document.head.insertAdjacentHTML("beforeend",'<style type="text/css">\n        .'+e+"::after {\n          content: '[▶]';\n        }\n        \n        .replypage ."+a+"::after {\n          content: '[Показать форму ответа]';\n        }\n        \n        ."+a+"::after {\n          content: '[Создать тред]';\n        }\n        \n        ."+a+",\n        ."+e+" {\n          cursor: pointer;\n        }\n        \n        #"+n+" .rules {\n          display: none;\n        }\n        \n      </style>")},x=function(){if(!document.querySelector("#de-main")){var e=document.querySelector("input[name=captcha] + a");if(e&&(e.removeAttribute("onclick"),e.addEventListener("click",function(e){p(),e.preventDefault()})),document.body.classList.contains("replypage")){var t=document.querySelector("[id^=thread]");f(t)}else f();if(E(),w(),s.addEventListener("click",function(e){k(),e.preventDefault()}),"MutationObserver"in window){var n=new MutationObserver(function(e){e.forEach(function(e){var t=!0,n=!1,r=void 0;try{for(var a,o=e.addedNodes[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(!i.querySelectorAll)return;w(i)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}})});n.observe(document.body,{childList:!0,subtree:!0})}}};document.body?x():document.addEventListener("DOMContentLoaded",x)}();