"use strict";!function(){var e,n,t={key:"mainpage",dummy:"",url:"/cgi-bin/captcha1.pl/b/"},r=function(){var e=document.createElement("table");return e.insertAdjacentHTML("beforeend",'\n        <tr>\n        \t<td class="doubledash">&gt;&gt;</td>\n        \t<td class="iichan-postform-container reply">\n           <div class="theader">Ответ в тред №<span class="iichan-quick-reply-thread"></span><div class="iichan-quick-reply-close-form-btn" title="Закрыть форму"><svg>\n            <use class="iichan-icon-form-close-use" xlink:href="/icons.svg#iichan-icon-close" width="16" height="16" viewBox="0 0 16 16"/>\n          </svg></div></div>\n          </td>\n        </tr>\n        \n      '),e.id="iichan-quick-reply-container",e.querySelector(".iichan-quick-reply-close-form-btn").addEventListener("click",function(e){return f(null,!0)}),{quickReplyContainer:e,postformContainer:e.querySelector(".iichan-postform-container")}}(),i=r.quickReplyContainer,a=r.postformContainer,c=((e=document.createElement("a")).classList.add("iichan-quick-reply-show-form-btn"),e),o=((n=document.createElement("input")).setAttribute("type","hidden"),n.setAttribute("name","parent"),n),l=function(){var e=document.querySelector("#captcha");if(e){var n=t.url,r=t.key,i=t.dummy;e.src="".concat(n,"?key=").concat(r,"&dummy=").concat(i,"&").concat(Math.random())}},d=function(e){if(e){var n=e.id.substr("thread-".length),r=e.querySelector("table:last-child .reply"),i=r?r.id.substr("reply".length):n;t.key="res".concat(n),t.dummy=i}else t.key="mainpage",t.dummy="";l()},u=function(e,n){var t=i.querySelector(".iichan-quick-reply-thread");t&&(t.textContent=n||"");var r=e.querySelector("[name=parent]");n?(r||(r=o,e.appendChild(r)),r.setAttribute("value",n)):r&&e.removeChild(r)},s=function(e,n){for(var t=e;t&&t!==document&&!t.matches(n);)t=t.parentNode;return t===document?null:t},p=function(e){var n=document.querySelector("[name=nya4]");n&&(n.focus(!1),e&&(e=">>".concat(e,"\n"),n.value.endsWith(e)||(n.value.length&&!n.value.endsWith("\n")&&(e="\n"+e),n.setRangeText(e,n.textLength,n.textLength,"end"))))},h=function(){var e=document.querySelector(".postarea");e&&e.appendChild(c);var n=document.querySelector("body > .theader");n&&(n.style.display="none")},y=function(e,n){var t=document.querySelector(".postarea");if(t&&(t.appendChild(e),n&&p()),i.parentNode&&i.parentNode.removeChild(i),c.parentNode){var r=document.querySelector("body > .theader");r&&(r.style.display=null),c.parentNode.removeChild(c)}if(document.body.classList.contains("replypage")){var a=document.querySelector("[id^=thread]"),o=a.id.substr("thread-".length);u(e,o),d(a)}else u(e,null),d()},f=function(e,n){var t=document.querySelector("#postform");t&&(e?t.dataset.replyTo===e.id?(t.dataset.replyTo="",y(t,!1)):e.classList.contains("reply")?(t.dataset.replyTo=e.id,function(e,n){var t=s(n,"table"),r=s(n,"[id^=thread]");if(t&&r){var c=r.id.substr("thread-".length),o=n.id.substr("reply".length);a.appendChild(e),t.parentNode.insertBefore(i,t.nextSibling),h(),u(e,c),d(r),p(o)}}(t,e)):(t.dataset.replyTo=e.id,function(e,n){var t=n.querySelector("table"),r=n.id.substr("thread-".length);a.appendChild(e),n.insertBefore(i,t),h(),u(e,r),d(n),p(r)}(t,e)):(t.dataset.replyTo="",y(t,!n)))},v=function(e){for(var n=e.target;n&&!n.classList.contains("iichan-quick-reply-btn");)n=n.parentElement;if(n){var t=document.getElementById(n.dataset.postId);f(t)}e.preventDefault()},m=function(e){if(e){var n=e.querySelector(":scope > .reflink");if(n)n.insertAdjacentHTML("afterend",'\n    <div class="iichan-quick-reply-btn" title="Быстрый ответ" data-post-id="'.concat(e.id,'">\n      <svg>\n        <use class="iichan-icon-reply-use" xlink:href="/icons.svg#iichan-icon-reply" width="16" height="16" viewBox="0 0 16 16"/>\n      </svg>\n    </div>\n  ')),e.querySelector(".iichan-quick-reply-btn").addEventListener("click",v)}},b=function(e){var n=(e||document).querySelectorAll(".reply, [id^=thread]"),t=!0,r=!1,i=void 0;try{for(var a,c=n[Symbol.iterator]();!(t=(a=c.next()).done);t=!0){var o=a.value;m(o)}}catch(e){r=!0,i=e}finally{try{t||null==c.return||c.return()}finally{if(r)throw i}}},q=function(){if(!document.querySelector("#de-main")){var e=document.querySelector("#captcha");e&&(t.url=e.getAttribute("src").match(/[^\?]*/)[0]);var n=document.querySelector("input[name=captcha] + a");if(n&&(n.removeAttribute("onclick"),n.addEventListener("click",function(e){l(),e.preventDefault()})),document.body.classList.contains("replypage")){var r=document.querySelector("[id^=thread]");d(r)}else d();if(document.head.insertAdjacentHTML("beforeend","<style type=\"text/css\">\n      .iichan-quick-reply-btn {\n        display: inline-block;\n        width: 16px;\n        height: 16px;\n        vertical-align: text-top;\n      }\n      \n      .iichan-quick-reply-btn > svg {\n        width: 16px;\n        height: 16px;\n      }\n      \n      .iichan-quick-reply-btn use {\n        pointer-events: none;\n      }\n      \n      .replypage .iichan-quick-reply-show-form-btn::after {\n        content: '[Показать форму ответа]';\n      }\n      \n      .iichan-quick-reply-show-form-btn::after {\n        content: '[Создать тред]';\n      }\n      \n      .iichan-quick-reply-show-form-btn,\n      .iichan-quick-reply-btn {\n        cursor: pointer;\n      }\n      \n      #iichan-quick-reply-container .rules {\n        display: none;\n      }\n      \n      #iichan-quick-reply-icons {\n        display: none;\n      }\n      \n      .iichan-postform-container .theader {\n        width: auto;\n      }\n      \n      .iichan-quick-reply-close-form-btn {\n        float: right;\n        cursor: pointer;\n        padding: 1px;\n      }\n      \n      .iichan-quick-reply-close-form-btn svg {\n        width: 16px;\n        height: 16px;\n        vertical-align: text-top;\n      }\n      \n      .iichan-quick-reply-close-form-btn use {\n        pointer-events: none;\n      }\n      \n    </style>"),b(),c.addEventListener("click",function(e){f(),e.preventDefault()}),"MutationObserver"in window)new MutationObserver(function(e){e.forEach(function(e){var n=!0,t=!1,r=void 0;try{for(var i,a=e.addedNodes[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var c=i.value;if(!c.querySelectorAll)return;b(c)}}catch(e){t=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(t)throw r}}})}).observe(document.body,{childList:!0,subtree:!0})}};document.body?q():document.addEventListener("DOMContentLoaded",q)}();