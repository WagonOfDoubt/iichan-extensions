!function(){"use strict";var e="iichan-quick-reply-btn",t="Быстрый ответ",n="iichan-quick-reply-container",r="iichan-postform-container",a="iichan-quick-reply-show-form-btn",o=function(){var e=document.createElement("table");e.insertAdjacentHTML("beforeend",'\n          <tr>\n          \t<td class="doubledash">&gt;&gt;</td>\n          \t<td class="'+r+' reply"></td>\n          </tr>\n          \n        '),e.id=n;var t=e.querySelector("."+r);return{quickReplyContainer:e,postformContainer:t}}(),i=o.quickReplyContainer,d=o.postformContainer,c=function(){var e=document.createElement("a");return e.classList.add(a),e}(),l=function(){var e=document.createElement("input");return e.setAttribute("type","hidden"),e.setAttribute("name","parent"),e}(),u=function(e,t){var n=e.querySelector("[name=parent]");return t?(n||(n=l,e.appendChild(n)),void n.setAttribute("value",t)):void(n&&e.removeChild(n))},s=function(e,t){for(var n=e;n&&n!==document&&!n.matches(t);)n=n.parentNode;return n===document?null:n},f=function(e){var t=document.querySelector("[name=nya4]");t&&(t.focus(!1),e&&(e=">>"+e+"\n",t.value.endsWith(e)||(t.value.length&&!t.value.endsWith("\n")&&(e="\n"+e),t.setRangeText(e,t.textLength,t.textLength,"end"))))},p=function(){var e=document.querySelector(".postarea");e&&e.appendChild(c)},y=function(e,t){var n=s(t,"table"),r=s(t,"[id^=thread]");if(n&&r){d.appendChild(e),n.parentNode.insertBefore(i,n.nextSibling),p();var a=r.id.substr("thread-".length);u(e,a);var o=t.id.substr("reply".length);f(o)}},v=function(e,t){var n=t.querySelector("table");d.appendChild(e),t.insertBefore(i,n),p();var r=t.id.substr("thread-".length);u(e,r),f(r)},h=function(e,t){var n=document.querySelector(".postarea");if(n&&(n.appendChild(e),t&&f()),i.parentNode&&i.parentNode.removeChild(i),c.parentNode&&c.parentNode.removeChild(c),document.body.classList.contains("replypage")){var r=document.querySelector("[id^=thread]"),a=r.id.substr("thread-".length);u(e,a)}else u(e,null)},m=function(e){var t=document.querySelector("#postform");t&&(e?t.dataset.replyTo===e.id?(t.dataset.replyTo="",h(t,!1)):e.classList.contains("reply")?(t.dataset.replyTo=e.id,y(t,e)):(t.dataset.replyTo=e.id,v(t,e)):(t.dataset.replyTo="",h(t,!0)))},b=function(e){var t=e.target,n=document.querySelector(t.dataset.postId);m(n)},q=function(n){if(n){var r=n.querySelector(":scope > .reflink");if(r){var a=document.createElement("span");a.title=t,a.classList.add(e),a.dataset.postId="#"+n.id,a.addEventListener("click",b),n.insertBefore(a,r.nextSibling)}}},S=function(e){var t=(e||document).querySelectorAll(".reply, [id^=thread]"),n=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var d=o.value;q(d)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}},g=function(){document.head.insertAdjacentHTML("beforeend",'<style type="text/css">\n        .'+e+"::after {\n          content: '[▶]';\n        }\n        \n        .replypage ."+a+"::after {\n          content: '[Показать форму ответа]';\n        }\n        \n        ."+a+"::after {\n          content: '[Создать тред]';\n        }\n        \n        ."+a+",\n        ."+e+" {\n          cursor: pointer;\n        }\n        \n        #"+n+" .rules {\n          display: none;\n        }\n        \n      </style>")},C=function(){if(!document.querySelector("#de-main")&&(g(),S(),c.addEventListener("click",function(e){return m()}),"MutationObserver"in window)){var e=new MutationObserver(function(e){e.forEach(function(e){var t=!0,n=!1,r=void 0;try{for(var a,o=e.addedNodes[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(!i.querySelectorAll)return;S(i)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}})});e.observe(document.body,{childList:!0,subtree:!0})}};document.body?C():document.addEventListener("DOMContentLoaded",C)}();