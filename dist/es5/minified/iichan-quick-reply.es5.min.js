"use strict";!function(){var e,t,n={key:"mainpage",dummy:"",url:"/cgi-bin/captcha1.pl/b/"},r=function(){var e=document.createElement("table");return e.insertAdjacentHTML("beforeend",'\n        <tr>\n        \t<td class="doubledash">&gt;&gt;</td>\n        \t<td class="'.concat("iichan-postform-container",' reply"></td>\n        </tr>\n        \n      ')),e.id="iichan-quick-reply-container",{quickReplyContainer:e,postformContainer:e.querySelector(".iichan-postform-container")}}(),a=r.quickReplyContainer,c=r.postformContainer,o=((e=document.createElement("a")).classList.add("iichan-quick-reply-show-form-btn"),e),i=((t=document.createElement("input")).setAttribute("type","hidden"),t.setAttribute("name","parent"),t),d=function(){var e=document.querySelector("#captcha");if(e){var t=n.url,r=n.key,a=n.dummy;e.src="".concat(t,"?key=").concat(r,"&dummy=").concat(a,"&").concat(Math.random())}},l=function(e){if(e){var t=e.id.substr("thread-".length),r=e.querySelector("table:last-child .reply"),a=r?r.id.substr("reply".length):t;n.key="res".concat(t),n.dummy=a}else n.key="mainpage",n.dummy="";d()},u=function(e,t){var n=e.querySelector("[name=parent]");t?(n||(n=i,e.appendChild(n)),n.setAttribute("value",t)):n&&e.removeChild(n)},s=function(e,t){for(var n=e;n&&n!==document&&!n.matches(t);)n=n.parentNode;return n===document?null:n},y=function(e){var t=document.querySelector("[name=nya4]");t&&(t.focus(!1),e&&(e=">>".concat(e,"\n"),t.value.endsWith(e)||(t.value.length&&!t.value.endsWith("\n")&&(e="\n"+e),t.setRangeText(e,t.textLength,t.textLength,"end"))))},p=function(){var e=document.querySelector(".postarea");e&&e.appendChild(o)},m=function(e,t){var n=document.querySelector(".postarea");if(n&&(n.appendChild(e),t&&y()),a.parentNode&&a.parentNode.removeChild(a),o.parentNode&&o.parentNode.removeChild(o),document.body.classList.contains("replypage")){var r=document.querySelector("[id^=thread]"),c=r.id.substr("thread-".length);u(e,c),l(r)}else u(e,null),l()},f=function(e){var t=document.querySelector("#postform");t&&(e?t.dataset.replyTo===e.id?(t.dataset.replyTo="",m(t,!1)):e.classList.contains("reply")?(t.dataset.replyTo=e.id,function(e,t){var n=s(t,"table"),r=s(t,"[id^=thread]");if(n&&r){var o=r.id.substr("thread-".length),i=t.id.substr("reply".length);c.appendChild(e),n.parentNode.insertBefore(a,n.nextSibling),p(),u(e,o),l(r),y(i)}}(t,e)):(t.dataset.replyTo=e.id,function(e,t){var n=t.querySelector("table"),r=t.id.substr("thread-".length);c.appendChild(e),t.insertBefore(a,n),p(),u(e,r),l(t),y(r)}(t,e)):(t.dataset.replyTo="",m(t,!0)))},h=function(e){var t=e.target,n=document.querySelector(t.dataset.postId);f(n)},v=function(e){if(e){var t=e.querySelector(":scope > .reflink");if(t){var n=document.createElement("span");n.title="Быстрый ответ",n.classList.add("iichan-quick-reply-btn"),n.dataset.postId="#"+e.id,n.addEventListener("click",h),e.insertBefore(n,t.nextSibling)}}},b=function(e){var t=(e||document).querySelectorAll(".reply, [id^=thread]"),n=!0,r=!1,a=void 0;try{for(var c,o=t[Symbol.iterator]();!(n=(c=o.next()).done);n=!0){var i=c.value;v(i)}}catch(e){r=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}},q=function(){if(!document.querySelector("#de-main")){var e=document.querySelector("#captcha");e&&(n.url=e.getAttribute("src").match(/[^\?]*/)[0]);var t=document.querySelector("input[name=captcha] + a");if(t&&(t.removeAttribute("onclick"),t.addEventListener("click",function(e){d(),e.preventDefault()})),document.body.classList.contains("replypage")){var r=document.querySelector("[id^=thread]");l(r)}else l();if(document.head.insertAdjacentHTML("beforeend",'<style type="text/css">\n      .'.concat("iichan-quick-reply-btn","::after {\n        content: '[▶]';\n      }\n      \n      .replypage .").concat("iichan-quick-reply-show-form-btn","::after {\n        content: '[Показать форму ответа]';\n      }\n      \n      .").concat("iichan-quick-reply-show-form-btn","::after {\n        content: '[Создать тред]';\n      }\n      \n      .").concat("iichan-quick-reply-show-form-btn",",\n      .").concat("iichan-quick-reply-btn"," {\n        cursor: pointer;\n      }\n      \n      #").concat("iichan-quick-reply-container"," .rules {\n        display: none;\n      }\n      \n    </style>")),b(),o.addEventListener("click",function(e){f(),e.preventDefault()}),"MutationObserver"in window)new MutationObserver(function(e){e.forEach(function(e){var t=!0,n=!1,r=void 0;try{for(var a,c=e.addedNodes[Symbol.iterator]();!(t=(a=c.next()).done);t=!0){var o=a.value;if(!o.querySelectorAll)return;b(o)}}catch(e){n=!0,r=e}finally{try{t||null==c.return||c.return()}finally{if(n)throw r}}})}).observe(document.body,{childList:!0,subtree:!0})}};document.body?q():document.addEventListener("DOMContentLoaded",q)}();