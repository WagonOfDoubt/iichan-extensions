!function(){"use strict";var e="iichan-quick-reply-btn",t="Быстрый ответ",n="iichan-quick-reply-container",r="iichan-postform-container",a="iichan-quick-reply-show-form-btn",o={key:"mainpage",dummy:"",url:"/cgi-bin/captcha1.pl/b/"},i=function(){var e=document.createElement("table");e.insertAdjacentHTML("beforeend",'\n          <tr>\n          \t<td class="doubledash">&gt;&gt;</td>\n          \t<td class="'+r+' reply"></td>\n          </tr>\n          \n        '),e.id=n;var t=e.querySelector("."+r);return{quickReplyContainer:e,postformContainer:t}}(),d=i.quickReplyContainer,c=i.postformContainer,u=function(){var e=document.createElement("a");return e.classList.add(a),e}(),l=function(){var e=document.createElement("input");return e.setAttribute("type","hidden"),e.setAttribute("name","parent"),e}(),s=function(){var e=document.querySelector("#captcha");if(e){var t=o.url,n=o.key,r=o.dummy;e.src=t+"?key="+n+"&dummy="+r+"&"+Math.random()}},y=function(e){if(e){var t=e.id.substr("thread-".length),n=e.querySelector("table:last-child .reply"),r=n?n.id.substr("reply".length):t;o.key="res"+t,o.dummy=r}else o.key="mainpage",o.dummy="";s()},p=function(e,t){var n=e.querySelector("[name=parent]");return t?(n||(n=l,e.appendChild(n)),void n.setAttribute("value",t)):void(n&&e.removeChild(n))},f=function(e,t){for(var n=e;n&&n!==document&&!n.matches(t);)n=n.parentNode;return n===document?null:n},m=function(e){var t=document.querySelector("[name=nya4]");t&&(t.focus(!1),e&&(e=">>"+e+"\n",t.value.endsWith(e)||(t.value.length&&!t.value.endsWith("\n")&&(e="\n"+e),t.setRangeText(e,t.textLength,t.textLength,"end"))))},v=function(){var e=document.querySelector(".postarea");e&&e.appendChild(u)},h=function(e,t){var n=f(t,"table"),r=f(t,"[id^=thread]");if(n&&r){var a=r.id.substr("thread-".length),o=t.id.substr("reply".length);c.appendChild(e),n.parentNode.insertBefore(d,n.nextSibling),v(),p(e,a),y(r),m(o)}},b=function(e,t){var n=t.querySelector("table"),r=t.id.substr("thread-".length);c.appendChild(e),t.insertBefore(d,n),v(),p(e,r),y(t),m(r)},q=function(e,t){var n=document.querySelector(".postarea");if(n&&(n.appendChild(e),t&&m()),d.parentNode&&d.parentNode.removeChild(d),u.parentNode&&u.parentNode.removeChild(u),document.body.classList.contains("replypage")){var r=document.querySelector("[id^=thread]"),a=r.id.substr("thread-".length);p(e,a),y(r)}else p(e,null),y()},g=function(e){var t=document.querySelector("#postform");t&&(e?t.dataset.replyTo===e.id?(t.dataset.replyTo="",q(t,!1)):e.classList.contains("reply")?(t.dataset.replyTo=e.id,h(t,e)):(t.dataset.replyTo=e.id,b(t,e)):(t.dataset.replyTo="",q(t,!0)))},S=function(e){var t=e.target,n=document.querySelector(t.dataset.postId);g(n)},k=function(n){if(n){var r=n.querySelector(":scope > .reflink");if(r){var a=document.createElement("span");a.title=t,a.classList.add(e),a.dataset.postId="#"+n.id,a.addEventListener("click",S),n.insertBefore(a,r.nextSibling)}}},L=function(e){var t=(e||document).querySelectorAll(".reply, [id^=thread]"),n=!0,r=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var d=o.value;k(d)}}catch(e){r=!0,a=e}finally{try{!n&&i.return&&i.return()}finally{if(r)throw a}}},C=function(){document.head.insertAdjacentHTML("beforeend",'<style type="text/css">\n        .'+e+"::after {\n          content: '[▶]';\n        }\n        \n        .replypage ."+a+"::after {\n          content: '[Показать форму ответа]';\n        }\n        \n        ."+a+"::after {\n          content: '[Создать тред]';\n        }\n        \n        ."+a+",\n        ."+e+" {\n          cursor: pointer;\n        }\n        \n        #"+n+" .rules {\n          display: none;\n        }\n        \n      </style>")},A=function(){if(!document.querySelector("#de-main")){var e=document.querySelector("#captcha");e&&(o.url=e.getAttribute("src").match(/[^\?]*/)[0]);var t=document.querySelector("input[name=captcha] + a");if(t&&(t.removeAttribute("onclick"),t.addEventListener("click",function(e){s(),e.preventDefault()})),document.body.classList.contains("replypage")){var n=document.querySelector("[id^=thread]");y(n)}else y();if(C(),L(),u.addEventListener("click",function(e){g(),e.preventDefault()}),"MutationObserver"in window){var r=new MutationObserver(function(e){e.forEach(function(e){var t=!0,n=!1,r=void 0;try{for(var a,o=e.addedNodes[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var i=a.value;if(!i.querySelectorAll)return;L(i)}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}})});r.observe(document.body,{childList:!0,subtree:!0})}}};document.body?A():document.addEventListener("DOMContentLoaded",A)}();