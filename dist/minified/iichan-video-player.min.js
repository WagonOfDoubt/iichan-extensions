(()=>{"use strict";const e=["webm","mp4","ogv"],t="iichan_video_settings",n="iichan-video-player",r="iichan-mute-video-checkbox",o="Включить звук при открытии видео",c=e=>{const c=JSON.parse(window.localStorage.getItem(t)||"{}");if(c.hasOwnProperty("enableSound")||(c.enableSound=!1),e.target.classList.contains(r))return setTimeout(()=>e.target.checked=!e.target.checked,0),c.enableSound=e.target.checked,window.localStorage.setItem(t,JSON.stringify(c)),void e.preventDefault();const i=e.currentTarget.parentNode;if("on"===e.currentTarget.videoMode)e.currentTarget.videoMode="off",i.removeChild(document.getElementById(e.currentTarget.videoplayerid)),e.currentTarget.innerHTML=e.currentTarget.thumbHTML;else{e.currentTarget.videoMode="on";const t=document.createElement("video");t.id="video"+(""+Math.random()).replace(/\D/g,""),t.poster=e.currentTarget.thumbSrc,t.src=e.currentTarget.href,t.autoplay=!0,t.controls=!0,t.loop=!0,t.muted=!c.enableSound,t.classList.add(n),e.currentTarget.videoplayerid=t.id,i.insertBefore(t,e.currentTarget.nextSibling);const r=c.enableSound?"checked":"";e.currentTarget.innerHTML=`
      <div>
        <input type="checkbox" ${r} class="iichan-mute-video-checkbox" title="${o}">
        <div class="iichan-hide-video-btn" title="Свернуть видео">[Свернуть видео]</div>
      </div>
      `}e.preventDefault()},i=t=>{const n=(t||document).querySelectorAll(".thumb");for(const r of n){const t=r.parentNode;if(t){const n=t.href.split(".").pop();e.includes(n)&&(t.thumbSrc=r.src,t.thumbHTML=t.innerHTML,t.addEventListener("click",c))}}},d=()=>document.head.insertAdjacentHTML("beforeend",`<style type="text/css">
      .iichan-video-player {
        max-width: 100%;
        height: auto;
        box-sizing: border-box;
        padding: 2px 20px;
        margin: 0;
      }
      .iichan-hide-video-btn {
        padding: 2px 20px;
      }
      .iichan-mute-video-checkbox {
        float: right;
      }
    </style>`),a=()=>{if(!document.querySelector("#de-main")&&(d(),i(),"MutationObserver"in window)){const e=new MutationObserver(e=>{e.forEach(e=>{for(const t of e.addedNodes){if(!t.querySelectorAll)return;i(t)}})});e.observe(document.body,{childList:!0,subtree:!0})}};document.body?a():document.addEventListener("DOMContentLoaded",a)})();