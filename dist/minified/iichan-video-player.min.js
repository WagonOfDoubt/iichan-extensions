(()=>{const e=["webm","mp4","ogv"],n=e=>{const n=JSON.parse(window.localStorage.getItem("iichan_video_settings")||"{}");if(n.hasOwnProperty("enableSound")||(n.enableSound=!1),e.target.classList.contains("iichan-mute-video-checkbox"))return setTimeout(()=>e.target.checked=!e.target.checked,0),n.enableSound=e.target.checked,window.localStorage.setItem("iichan_video_settings",JSON.stringify(n)),void e.preventDefault();const t=e.currentTarget.parentNode;if("on"===e.currentTarget.videoMode)e.currentTarget.videoMode="off",t.removeChild(document.getElementById(e.currentTarget.videoplayerid)),e.currentTarget.innerHTML=e.currentTarget.thumbHTML;else{e.currentTarget.videoMode="on";const i=document.createElement("video");i.id="video"+(""+Math.random()).replace(/\D/g,""),i.poster=e.currentTarget.thumbSrc,i.src=e.currentTarget.href,i.autoplay=!0,i.controls=!0,i.loop=!0,i.muted=!n.enableSound,i.classList.add("iichan-video-player"),e.currentTarget.videoplayerid=i.id,t.insertBefore(i,e.currentTarget.nextSibling);const o=n.enableSound?"checked":"";e.currentTarget.innerHTML=`\n    <div>\n      <input type="checkbox" ${o} class="iichan-mute-video-checkbox" title="Включить звук при открытии видео">\n      <div class="iichan-hide-video-btn" title="Закрыть видео"><span><svg>\n        <use class="iichan-icon-close-use" xlink:href="#iichan-icon-close" width="16" height="16" viewBox="0 0 16 16"/>\n      </svg>Закрыть видео</span></div>\n    </div>\n    `}e.preventDefault()},t=t=>{const i=(t||document).querySelectorAll(".thumb");for(const t of i){const i=t.parentNode;if(!i)continue;const o=i.href.split(".").pop();e.includes(o)&&(i.thumbSrc=t.src,i.thumbHTML=i.innerHTML,i.addEventListener("click",n))}},i=()=>{if(!document.querySelector("#de-main")&&((()=>document.head.insertAdjacentHTML("beforeend","<style type=\"text/css\">\n    .iichan-video-player {\n      max-width: 100%;\n      height: auto;\n      box-sizing: border-box;\n      padding: 2px 20px;\n      margin: 0;\n    }\n    \n    .iichan-hide-video-btn {\n      margin: 2px 20px;\n    }\n    \n    .iichan-mute-video-checkbox {\n      float: right;\n    }\n    \n    .iichan-hide-video-btn > span::before {\n      content: '[';\n    }\n    \n    .iichan-hide-video-btn > span::after {\n      content: ']';\n    }\n    \n    .iichan-hide-video-btn svg {\n      width: 16px;\n      height: 16px;\n      vertical-align: text-top;\n    }\n    \n    .iichan-hide-video-btn use {\n      pointer-events: none;\n    }\n    \n    a.imglink {\n      text-decoration: none;\n    }\n  </style>"))(),document.body.insertAdjacentHTML("beforeend",'<div id="iichan-video-player-icons">\n    \n    <svg xmlns="http://www.w3.org/2000/svg">\n      <symbol id="iichan-icon-close" width="16" height="16" viewBox="0 0 16 16">\n        <path\n          fill="currentcolor"\n          d="m 11.734373,2.0393046 c -0.551714,0.0032 -1.101132,0.214707 -1.521485,0.636719 l -2.2656251,2.275391 -2.359375,-2.314453 c -0.798816,-0.783843 -2.079336,-0.777297 -2.86914,0.01563 l -0.171875,0.171875 c -0.789805,0.792922 -0.781239,2.063814 0.01758,2.847656 l 2.359375,2.314453 -2.304688,2.3125004 c -0.840706,0.844025 -0.83272,2.194937 0.01758,3.029297 l 0.01172,0.01172 c 0.850299,0.834359 2.212029,0.826446 3.052734,-0.01758 l 2.302735,-2.3125 2.4101561,2.363281 c 0.798817,0.783842 2.077383,0.777297 2.867188,-0.01563 l 0.171875,-0.173828 c 0.789804,-0.792922 0.781238,-2.061861 -0.01758,-2.845703 l -2.408204,-2.3632824 2.265625,-2.27539 c 0.840706,-0.844025 0.832721,-2.194938 -0.01758,-3.029297 l -0.0098,-0.01172 c -0.42515,-0.41718 -0.979537,-0.622294 -1.53125,-0.619141 z"/>\n      </symbol>\n    </svg>\n  \n  </div>'),t(),"MutationObserver"in window)){new MutationObserver(e=>{e.forEach(e=>{for(const n of e.addedNodes){if(!n.querySelectorAll)return;t(n)}})}).observe(document.body,{childList:!0,subtree:!0})}};document.body?i():document.addEventListener("DOMContentLoaded",i)})();