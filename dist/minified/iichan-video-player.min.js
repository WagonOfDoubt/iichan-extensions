(()=>{const e=["webm","mp4","ogv"],n=e=>{const n=JSON.parse(window.localStorage.getItem("iichan_video_settings")||"{}");if(n.hasOwnProperty("enableSound")||(n.enableSound=!1),e.target.classList.contains("iichan-mute-video-checkbox"))return setTimeout(()=>e.target.checked=!e.target.checked,0),n.enableSound=e.target.checked,window.localStorage.setItem("iichan_video_settings",JSON.stringify(n)),void e.preventDefault();const t=e.currentTarget.parentNode;if("on"===e.currentTarget.videoMode)e.currentTarget.videoMode="off",t.removeChild(document.getElementById(e.currentTarget.videoplayerid)),e.currentTarget.innerHTML=e.currentTarget.thumbHTML;else{e.currentTarget.videoMode="on";const i=document.createElement("video");i.id="video"+(""+Math.random()).replace(/\D/g,""),i.poster=e.currentTarget.thumbSrc,i.src=e.currentTarget.href,i.autoplay=!0,i.controls=!0,i.loop=!0,i.muted=!n.enableSound,i.classList.add("iichan-video-player"),e.currentTarget.videoplayerid=i.id,t.insertBefore(i,e.currentTarget.nextSibling);const o=n.enableSound?"checked":"";e.currentTarget.innerHTML=`\n    <div>\n      <input type="checkbox" ${o} class="iichan-mute-video-checkbox" title="Включить звук при открытии видео">\n      <div class="iichan-hide-video-btn" title="Закрыть видео"><span><svg>\n        <use class="iichan-icon-video-close-use" xlink:href="/extras/icons.svg#iichan-icon-close" width="16" height="16" viewBox="0 0 16 16"/>\n      </svg>Закрыть видео</span></div>\n    </div>\n    `}e.preventDefault()},t=t=>{const i=(t||document).querySelectorAll(".thumb");for(const t of i){const i=t.parentNode;if(!i)continue;const o=i.href.split(".").pop();e.includes(o)&&(i.thumbSrc=t.src,i.thumbHTML=i.innerHTML,i.addEventListener("click",n))}},i=()=>{if(!document.querySelector("#de-main")&&((()=>document.head.insertAdjacentHTML("beforeend","<style type=\"text/css\">\n    .iichan-video-player {\n      max-width: 100%;\n      height: auto;\n      box-sizing: border-box;\n      padding: 2px 20px;\n      margin: 0;\n    }\n    \n    .iichan-hide-video-btn {\n      margin: 2px 20px;\n    }\n    \n    .iichan-mute-video-checkbox {\n      float: right;\n    }\n    \n    .iichan-hide-video-btn > span::before {\n      content: '[';\n    }\n    \n    .iichan-hide-video-btn > span::after {\n      content: ']';\n    }\n    \n    .iichan-hide-video-btn svg {\n      width: 16px;\n      height: 16px;\n      vertical-align: text-top;\n    }\n    \n    .iichan-hide-video-btn use {\n      pointer-events: none;\n    }\n    \n    #iichan-video-player-icons {\n      display: none;\n    }\n    \n    a.imglink {\n      text-decoration: none;\n    }\n  </style>"))(),t(),"MutationObserver"in window)){new MutationObserver(e=>{e.forEach(e=>{for(const n of e.addedNodes){if(!n.querySelectorAll)return;t(n)}})}).observe(document.body,{childList:!0,subtree:!0})}};document.body?i():document.addEventListener("DOMContentLoaded",i)})();