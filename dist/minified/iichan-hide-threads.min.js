(()=>{"use strict";const e=50,t="iichan_hidden_threads",n="iichan-hide-thread-btn",d="Скрыть тред",i="iichan-thread-hidden",c="iichan-hidden-thread-placeholder",o=window.location.href.match(/(?:\w+\.\w+\/)(.*)(?=\/)/)[1],r=()=>{const e=JSON.parse(window.localStorage.getItem(t)||"{}");return Array.isArray(e)?{}:e},a=e=>{window.localStorage.setItem(t,JSON.stringify(e))},s=(e,t)=>{const n=r();if(n[o]||(n[o]=[]),t)n[o].includes(e)||n[o].push(e);else{const t=n[o].indexOf(e);if(t===-1)return;n[o].splice(t,1)}a(n)},l=e=>{if(e){const t=e.querySelector(":scope > label");if(t){const i=document.createElement("span");i.title=d,i.classList.add(n),i.dataset.threadId=e.id,i.addEventListener("click",p),e.insertBefore(i,t.nextSibling)}}},u=e=>{if(e){const t=document.createElement("div");t.title="Скрыть тред",t.classList.add(n,"reply"),t.dataset.threadId=e.id,t.addEventListener("click",y),e.querySelector(".catthread").appendChild(t)}},h=t=>{if(t){const n=t.id.split("-").pop();let d=t.querySelector(".filetitle").innerText||t.querySelector("blockquote").innerText;d=d.substr(0,e);const i="iichan-hidden-"+t.id;t.insertAdjacentHTML("beforebegin",`
      <div class="reply ${c}" id="${i}">Тред <a>№${n}</a> скрыт (${d||"изображение"})</div>
    `);const o=t.previousElementSibling.querySelector(":scope > a");o.dataset.threadId=t.id,o.addEventListener("click",m)}},f=e=>{const t=!!document.querySelector(".catthreadlist"),n=t?".catthreadlist a":"[id^=thread]",d=e&&e.id.startsWith("thread-")?[e]:(e||document).querySelectorAll(n),i=t?u:l,c=r();for(const a of d)a.id=t?"thread-"+a.title.match(/^#(\d+)\s/)[1]:a.id,i(a),c[o]&&c[o].includes(a.id)&&p(a.id)},m=e=>{const t=e.target?e.target.dataset.threadId:e;s(t,!1);const n=document.getElementById(t);if(n){n.classList.remove(i);const e=document.getElementById("iichan-hidden-"+t);e&&e.parentElement.removeChild(e)}},p=e=>{const t=e.target?e.target.dataset.threadId:e;s(t,!0);const n=document.getElementById(t);if(n&&n.parentNode){n.classList.add(i);const e=!!document.querySelector(".catthreadlist");e||h(n)}},y=e=>{const t=e.target?e.target.dataset.threadId:e,n=t.split("-").pop(),d=document.getElementById("thread-"+n);s(t,d.classList.toggle(i)),e.preventDefault&&e.preventDefault()},g=()=>{document.head.insertAdjacentHTML("beforeend",`<style type="text/css">
        .${c} {
            pointer-events: none;
        }
        
        .${c} a {
            cursor: pointer;
            pointer-events: auto;
        }
        
        .${c}:hover + div,
        .${c}:hover + div + br {
            display: block !important;
        }
        
        .${c} + div {
            display: none;
        }
        .${c} + div +  br {
            display: none;
        }
        
        .${n} {
            margin-left: 0.2em;
            cursor: pointer;
        }
        
        .${n}::after {
            content: '[✕]';
        }
        
        .catthreadlist a {
          position: relative;
          transition: all .3s ease-in-out;
        }
        
        .catthreadlist .iichan-thread-hidden {
          opacity: .6;
        }
        
        .catthreadlist .iichan-thread-hidden:not(:hover) {
          opacity: .2;
          filter: blur(1px);
        }
        
        .catthread:hover .${n} {
          display: block;
        }
        
        .catthread .${n} {
          text-decoration: none;
          position: absolute;
          top: 0;
          right: 0;
          display: none;
          width: 25px;
          height: 25px;
        }
        
        .catthreadlist .iichan-thread-hidden .${n}::after {
          content: '[+]';
        }
      </style>`)},S=()=>{if(!document.querySelector("#de-main")&&!document.querySelector("body.replypage")&&(g(),f(),"MutationObserver"in window)){const e=new MutationObserver(e=>{e.forEach(e=>{for(const t of e.addedNodes){if(!t.querySelectorAll)return;f(t)}})});e.observe(document.body,{childList:!0,subtree:!0})}};document.body?S():document.addEventListener("DOMContentLoaded",S)})();