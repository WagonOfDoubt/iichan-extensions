(()=>{const e="iichan-hide-thread-btn",n="iichan-hidden-thread-placeholder",t=window.location.href.match(/(?:\w+\.\w+\/)(.*)(?=\/)/)[1],i=()=>{const e=JSON.parse(window.localStorage.getItem("iichan_hidden_threads")||"{}");return Array.isArray(e)?{}:e},d=(e,n)=>{const d=i();if(d[t]||(d[t]=[]),n)d[t].includes(e)||d[t].push(e);else{const n=d[t].indexOf(e);if(-1===n)return;d[t].splice(n,1)}(e=>{window.localStorage.setItem("iichan_hidden_threads",JSON.stringify(e))})(d)},r=n=>{if(!n)return;const t=n.querySelector(":scope > .reflink");t&&(t.insertAdjacentHTML("afterend",`\n    <div class="${e}" title="Скрыть тред" data-thread-id="${n.id}">\n      <svg>\n        <use class="iichan-icon-hide-use" xlink:href="#iichan-icon-hide" width="16" height="16" viewBox="0 0 16 16"/>\n        <use class="iichan-icon-unhide-use" xlink:href="#iichan-icon-unhide" width="16" height="16" viewBox="0 0 16 16"/>\n      </svg>\n    </div>\n  `),n.querySelector(`.${e}`).addEventListener("click",h))},a=n=>{if(!n)return;const t=n.querySelector(".catthread");t.insertAdjacentHTML("beforeend",`\n    <div class="${e}" title="Скрыть тред" data-thread-id="${n.id}">\n      <svg>\n        <use class="iichan-icon-hide-use" xlink:href="#iichan-icon-hide" width="16" height="16" viewBox="0 0 16 16"/>\n        <use class="iichan-icon-unhide-use" xlink:href="#iichan-icon-unhide" width="16" height="16" viewBox="0 0 16 16"/>\n      </svg>\n    </div>\n  `);const i=t.querySelector(`.${e}`);i.classList.add("reply"),i.addEventListener("click",l)},o=e=>{const n=!!document.querySelector(".catthreadlist"),d=n?".catthreadlist a":"[id^=thread]",o=e&&e.id.startsWith("thread-")?[e]:(e||document).querySelectorAll(d),c=n?a:r,s=i();for(const e of o)e.id=n?"thread-"+e.title.match(/^#(\d+)\s/)[1]:e.id,c(e),s[t]&&s[t].includes(e.id)&&h(e.id)},c=e=>{if("string"==typeof e)return e;let n=e.target;for(;n&&(!n.dataset||!n.dataset.threadId);)n=n.parentElement;return n&&n.dataset.threadId},s=e=>{const n=c(e);d(n,!1);const t=document.getElementById(n);if(!t)return;t.classList.remove("iichan-thread-hidden");const i=document.getElementById("iichan-hidden-"+n);i&&i.parentElement.removeChild(i),e.preventDefault&&e.preventDefault()},h=e=>{const t=c(e);d(t,!0);const i=document.getElementById(t);i&&i.parentNode&&(i.classList.add("iichan-thread-hidden"),!!document.querySelector(".catthreadlist")||(e=>{if(!e)return;const t=e.id.split("-").pop();let i=e.querySelector(".filetitle").innerText||e.querySelector("blockquote").innerText;i=i.substr(0,50);const d="iichan-hidden-"+e.id;e.insertAdjacentHTML("beforebegin",`\n    <div class="reply ${n}" id="${d}">Тред <a title="Раскрыть тред" data-thread-id="${e.id}">№${t}</a> скрыт (${i||"изображение"})</div>\n  `),e.previousElementSibling.querySelector(":scope > a").addEventListener("click",s)})(i),e.preventDefault&&e.preventDefault())},l=e=>{const n=c(e),t=n.split("-").pop(),i=document.getElementById("thread-"+t);d(n,i.classList.toggle("iichan-thread-hidden")),e.preventDefault&&e.preventDefault()},u=()=>{if(!document.querySelector("#de-main")&&!document.querySelector("body.replypage")&&(document.head.insertAdjacentHTML("beforeend",`<style type="text/css">\n      .${n} {\n        pointer-events: none;\n      }\n      \n      .${n} a {\n        cursor: pointer;\n        pointer-events: auto;\n      }\n      \n      .${n}:hover + div,\n      .${n}:hover + div + br {\n        display: block !important;\n      }\n      \n      .${n} + div {\n        display: none;\n      }\n      .${n} + div +  br {\n        display: none;\n      }\n      \n      .${e} {\n        margin-left: 0.2em;\n        cursor: pointer;\n        display: inline-block;\n        width: 16px;\n        height: 16px;\n        vertical-align: text-top;\n      }\n      \n      .${e} use {\n        pointer-events: none;\n      }\n      \n      .${e} > svg {\n        width: 16px;\n        height: 16px;\n      }\n      \n      [id^=thread]:not(.iichan-thread-hidden) .${e} .iichan-icon-unhide-use {\n        display: none;\n      }\n      \n      [id^=thread].iichan-thread-hidden .${e} .iichan-icon-hide-use {\n        display: none;\n      }\n      \n      .catthreadlist a {\n        position: relative;\n        transition: opacity .3s ease-in-out, filter .3s ease-in-out;\n      }\n      \n      .catthreadlist .iichan-thread-hidden {\n        opacity: .6;\n      }\n      \n      .catthreadlist .iichan-thread-hidden:not(:hover) {\n        opacity: .1;\n        filter: grayscale(100%);\n      }\n      \n      .catthread:hover .${e} {\n        display: block;\n      }\n      \n      .catthread .${e} {\n        text-decoration: none;\n        position: absolute;\n        top: 0;\n        right: 0;\n        display: none;\n        padding: 6px;\n      }\n      \n    </style>`),document.body.insertAdjacentHTML("beforeend",'<div id="iichan-hide-threads-icons">\n    \n    <svg xmlns="http://www.w3.org/2000/svg">\n      <symbol id="iichan-icon-hide" width="16" height="16" viewBox="0 0 16 16">\n        <path\n          fill="currentcolor"\n          d="m 2.8925753,6.0097655 c -1.039639,0 -1.876953,0.837315 -1.876953,1.876954 v 0.226562 c 0,1.039639 0.837314,1.876953 1.876953,1.876953 10.8787687,0 0.063512,0 10.2148497,0 1.039637,0 1.876953,-0.837314 1.876953,-1.876953 v -0.226562 c 0,-1.039639 -0.837315,-1.876954 -1.876953,-1.876954 -10.8494379,0 -0.248141,0 -10.2148497,0 z"/>\n      </symbol>\n      <symbol id="iichan-icon-unhide" width="16" height="16" viewBox="0 0 16 16">\n        <path\n          fill="currentcolor"\n          d="m 7.9589815,1.003906 c -1.106736,0 -1.996094,0.89131 -1.996094,1.998047 v 2.982421 h -3.070312 c -1.039639,0 -1.876953,0.837315 -1.876953,1.876954 V 8.08789 c 0,1.039639 0.837314,1.876953 1.876953,1.876953 h 3.070312 v 3.033204 c 0,1.106736 0.889358,1.998047 1.996094,1.998047 h 0.01563 c 1.106736,0 1.996094,-0.891311 1.996094,-1.998047 V 9.964843 h 3.1367195 c 1.039637,0 1.876953,-0.837314 1.876953,-1.876953 V 7.861328 c 0,-1.039639 -0.837315,-1.876954 -1.876953,-1.876954 H 9.9707005 V 3.001953 c 0,-1.106737 -0.889358,-1.998047 -1.996094,-1.998047 z"/>\n      </symbol>\n    </svg>\n  \n  </div>'),o(),"MutationObserver"in window)){new MutationObserver(e=>{e.forEach(e=>{for(const n of e.addedNodes){if(!n.querySelectorAll)return;o(n)}})}).observe(document.body,{childList:!0,subtree:!0})}};document.body?u():document.addEventListener("DOMContentLoaded",u)})();