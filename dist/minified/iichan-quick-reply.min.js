(()=>{const e={key:"mainpage",dummy:"",url:"/cgi-bin/captcha1.pl/b/"},{quickReplyContainer:n,postformContainer:t}=(()=>{const e=document.createElement("table");return e.insertAdjacentHTML("beforeend",'\n        <tr>\n        \t<td class="doubledash">&gt;&gt;</td>\n        \t<td class="iichan-postform-container reply">\n           <div class="theader">Ответ в тред №<span class="iichan-quick-reply-thread"></span><div class="iichan-quick-reply-close-form-btn" title="Закрыть форму"><svg>\n            <use class="iichan-icon-form-close-use" xlink:href="#iichan-icon-form-close" width="16" height="16" viewBox="0 0 16 16"/>\n          </svg></div></div>\n          </td>\n        </tr>\n        \n      '),e.id="iichan-quick-reply-container",e.querySelector(".iichan-quick-reply-close-form-btn").addEventListener("click",e=>p(null,!0)),{quickReplyContainer:e,postformContainer:e.querySelector(".iichan-postform-container")}})(),i=(()=>{const e=document.createElement("a");return e.classList.add("iichan-quick-reply-show-form-btn"),e})(),r=(()=>{const e=document.createElement("input");return e.setAttribute("type","hidden"),e.setAttribute("name","parent"),e})(),c=()=>{const n=document.querySelector("#captcha");if(!n)return;const{url:t,key:i,dummy:r}=e;n.src=`${t}?key=${i}&dummy=${r}&${Math.random()}`},o=n=>{if(n){const t=n.id.substr("thread-".length),i=n.querySelector("table:last-child .reply"),r=i?i.id.substr("reply".length):t;e.key=`res${t}`,e.dummy=r}else e.key="mainpage",e.dummy="";c()},l=(e,t)=>{const i=n.querySelector(".iichan-quick-reply-thread");i&&(i.textContent=t||"");let c=e.querySelector("[name=parent]");t?(c||(c=r,e.appendChild(c)),c.setAttribute("value",t)):c&&e.removeChild(c)},a=(e,n)=>{let t=e;for(;t&&t!==document&&!t.matches(n);)t=t.parentNode;return t===document?null:t},s=e=>{const n=document.querySelector("[name=nya4]");n&&(n.focus(!1),e&&(e=`>>${e}\n`,n.value.endsWith(e)||(n.value.length&&!n.value.endsWith("\n")&&(e="\n"+e),n.setRangeText(e,n.textLength,n.textLength,"end"))))},d=()=>{const e=document.querySelector(".postarea");e&&e.appendChild(i);const n=document.querySelector("body > .theader");n&&(n.style.display="none")},u=(e,t)=>{const r=document.querySelector(".postarea");if(r&&(r.appendChild(e),t&&s()),n.parentNode&&n.parentNode.removeChild(n),i.parentNode){const e=document.querySelector("body > .theader");e&&(e.style.display=null),i.parentNode.removeChild(i)}if(document.body.classList.contains("replypage")){const n=document.querySelector("[id^=thread]"),t=n.id.substr("thread-".length);l(e,t),o(n)}else l(e,null),o()},p=(e,i)=>{const r=document.querySelector("#postform");r&&(e?r.dataset.replyTo===e.id?(r.dataset.replyTo="",u(r,!1)):e.classList.contains("reply")?(r.dataset.replyTo=e.id,((e,i)=>{const r=a(i,"table"),c=a(i,"[id^=thread]");if(!r||!c)return;const u=c.id.substr("thread-".length),p=i.id.substr("reply".length);t.appendChild(e),r.parentNode.insertBefore(n,r.nextSibling),d(),l(e,u),o(c),s(p)})(r,e)):(r.dataset.replyTo=e.id,((e,i)=>{const r=i.querySelector("table"),c=i.id.substr("thread-".length);t.appendChild(e),i.insertBefore(n,r),d(),l(e,c),o(i),s(c)})(r,e)):(r.dataset.replyTo="",u(r,!i)))},h=e=>{let n=e.target;for(;n&&!n.classList.contains("iichan-quick-reply-btn");)n=n.parentElement;if(n){const e=document.getElementById(n.dataset.postId);p(e)}e.preventDefault()},y=e=>{if(!e)return;const n=e.querySelector(":scope > .reflink");n&&(n.insertAdjacentHTML("afterend",`\n    <div class="iichan-quick-reply-btn" title="Быстрый ответ" data-post-id="${e.id}">\n      <svg>\n        <use class="iichan-icon-reply-use" xlink:href="#iichan-icon-reply" width="16" height="16" viewBox="0 0 16 16"/>\n      </svg>\n    </div>\n  `),e.querySelector(".iichan-quick-reply-btn").addEventListener("click",h))},m=e=>{const n=(e||document).querySelectorAll(".reply, [id^=thread]");for(const e of n)y(e)},b=()=>{if(document.querySelector("#de-main"))return;const n=document.querySelector("#captcha");n&&(e.url=n.getAttribute("src").match(/[^\?]*/)[0]);const t=document.querySelector("input[name=captcha] + a");if(t&&(t.removeAttribute("onclick"),t.addEventListener("click",e=>{c(),e.preventDefault()})),document.body.classList.contains("replypage")){const e=document.querySelector("[id^=thread]");o(e)}else o();if(document.head.insertAdjacentHTML("beforeend","<style type=\"text/css\">\n      .iichan-quick-reply-btn {\n        display: inline-block;\n        width: 16px;\n        height: 16px;\n        vertical-align: text-top;\n      }\n      \n      .iichan-quick-reply-btn > svg {\n        width: 16px;\n        height: 16px;\n      }\n      \n      .iichan-quick-reply-btn use {\n        pointer-events: none;\n      }\n      \n      .replypage .iichan-quick-reply-show-form-btn::after {\n        content: '[Показать форму ответа]';\n      }\n      \n      .iichan-quick-reply-show-form-btn::after {\n        content: '[Создать тред]';\n      }\n      \n      .iichan-quick-reply-show-form-btn,\n      .iichan-quick-reply-btn {\n        cursor: pointer;\n      }\n      \n      #iichan-quick-reply-container .rules {\n        display: none;\n      }\n      \n      #iichan-quick-reply-icons {\n        display: none;\n      }\n      \n      .iichan-postform-container .theader {\n        width: auto;\n      }\n      \n      .iichan-quick-reply-close-form-btn {\n        float: right;\n        cursor: pointer;\n        padding: 1px;\n      }\n      \n      .iichan-quick-reply-close-form-btn svg {\n        width: 16px;\n        height: 16px;\n        vertical-align: text-top;\n      }\n      \n      .iichan-quick-reply-close-form-btn use {\n        pointer-events: none;\n      }\n      \n    </style>"),document.body.insertAdjacentHTML("beforeend",'<div id="iichan-quick-reply-icons">\n    \n    <svg xmlns="http://www.w3.org/2000/svg">\n      <symbol id="iichan-icon-reply" width="16" height="16" viewBox="0 0 16 16">\n        <path\n          fill="currentcolor"\n          d="M 8,0.98745 A 7.0133929,5.9117254 0 0 0 0.986328,6.89859 7.0133929,5.9117254 0 0 0 3.037109,11.07043 L 1.835937,15.01255 6.230469,12.61078 A 7.0133929,5.9117254 0 0 0 8,12.80973 7.0133929,5.9117254 0 0 0 15.013672,6.89859 7.0133929,5.9117254 0 0 0 8,0.98745 Z"/>\n      </symbol>\n      <symbol id="iichan-icon-form-close" width="16" height="16" viewBox="0 0 16 16">\n        <path\n          fill="currentcolor"\n          d="m 11.734373,2.0393046 c -0.551714,0.0032 -1.101132,0.214707 -1.521485,0.636719 l -2.2656251,2.275391 -2.359375,-2.314453 c -0.798816,-0.783843 -2.079336,-0.777297 -2.86914,0.01563 l -0.171875,0.171875 c -0.789805,0.792922 -0.781239,2.063814 0.01758,2.847656 l 2.359375,2.314453 -2.304688,2.3125004 c -0.840706,0.844025 -0.83272,2.194937 0.01758,3.029297 l 0.01172,0.01172 c 0.850299,0.834359 2.212029,0.826446 3.052734,-0.01758 l 2.302735,-2.3125 2.4101561,2.363281 c 0.798817,0.783842 2.077383,0.777297 2.867188,-0.01563 l 0.171875,-0.173828 c 0.789804,-0.792922 0.781238,-2.061861 -0.01758,-2.845703 l -2.408204,-2.3632824 2.265625,-2.27539 c 0.840706,-0.844025 0.832721,-2.194938 -0.01758,-3.029297 l -0.0098,-0.01172 c -0.42515,-0.41718 -0.979537,-0.622294 -1.53125,-0.619141 z"/>\n      </symbol>\n    </svg>\n  \n  </div>'),m(),i.addEventListener("click",e=>{p(),e.preventDefault()}),"MutationObserver"in window){new MutationObserver(e=>{e.forEach(e=>{for(const n of e.addedNodes){if(!n.querySelectorAll)return;m(n)}})}).observe(document.body,{childList:!0,subtree:!0})}};document.body?b():document.addEventListener("DOMContentLoaded",b)})();